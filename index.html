<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OASIS - 多源信息聚合与洞察驱动系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-cloud@1.2.5/build/d3.layout.cloud.js"></script>

    <style>
        :root {
            --bg-color: #0a0a1a;
            --primary-color: #00f2ff;
            --secondary-color: #ff00ff;
            --border-color: rgba(0, 242, 255, 0.2);
            --card-bg: rgba(10, 20, 40, 0.5);
            --glow-color-primary: rgba(0, 242, 255, 0.5);
            --glow-color-secondary: rgba(255, 0, 255, 0.5);
        }

        body {
            background-color: var(--bg-color);
            color: #e0e0e0;
            font-family: 'Noto Sans SC', sans-serif;
            overflow-x: hidden;
        }

        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }

        .glassmorphism {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2), 0 0 5px var(--glow-color-primary);
        }

        .neon-text-primary {
            color: var(--primary-color);
            text-shadow: 0 0 5px var(--primary-color), 0 0 10px var(--primary-color), 0 0 15px var(--glow-color-primary);
        }
        
        .neon-text-secondary {
            color: var(--secondary-color);
            text-shadow: 0 0 5px var(--secondary-color), 0 0 10px var(--secondary-color), 0 0 15px var(--glow-color-secondary);
        }

        .neon-border {
            border: 1px solid var(--primary-color);
            box-shadow: 0 0 8px var(--glow-color-primary), inset 0 0 8px var(--glow-color-primary);
        }
        
        .neon-border-secondary {
            border: 1px solid var(--secondary-color);
            box-shadow: 0 0 8px var(--glow-color-secondary), inset 0 0 8px var(--glow-color-secondary);
        }

        .sidebar-icon {
            transition: all 0.3s ease;
        }
        .sidebar-icon:hover, .sidebar-item.active .sidebar-icon {
            color: var(--primary-color);
            transform: scale(1.1);
            text-shadow: 0 0 10px var(--glow-color-primary);
        }
        
        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(0, 242, 255, 0.15) 0%, rgba(0, 242, 255, 0) 100%);
            border-right: 3px solid var(--primary-color);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px var(--glow-color-primary), 0 0 10px var(--glow-color-secondary);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px var(--glow-color-primary), 0 0 15px var(--glow-color-secondary);
        }

        .btn-secondary {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: rgba(0, 242, 255, 0.1);
            box-shadow: 0 0 8px var(--glow-color-primary);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00ffff;
        }
        
        /* Animation for cards */
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Toast Notification */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Switch toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
            box-shadow: 0 0 5px var(--glow-color-primary);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        /* Workflow Editor Styles */
        .workflow-editor-modal {
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(15px);
        }
        .workflow-node {
            cursor: grab;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }
        .workflow-node:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--glow-color-primary);
        }
        #workflow-canvas {
            background-image:
                linear-gradient(rgba(0, 242, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
            overflow: hidden;
        }
        .canvas-node {
            position: absolute;
            cursor: move;
            border: 2px solid transparent;
        }
        .canvas-node.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--glow-color-primary);
        }
        .node-connector {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #fff;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            cursor: crosshair;
            transform: translate(-50%, -50%);
        }
        .node-connector.output {
            right: -6px;
            top: 50%;
        }
        .node-connector.input {
            left: -6px;
            top: 50%;
        }
        #workflow-svg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        #workflow-svg-layer path {
            stroke: var(--primary-color);
            stroke-width: 3;
            fill: none;
            animation: dash 2s linear infinite;
            pointer-events: auto; /* Allow clicks on paths */
            cursor: pointer;
            transition: stroke-width 0.2s ease, stroke 0.2s ease;
        }
        #workflow-svg-layer path:hover {
            stroke-width: 5;
        }
        #workflow-svg-layer path.selected {
            stroke: var(--secondary-color);
            stroke-width: 5;
            animation: none; /* Stop animation when selected */
        }
        @keyframes dash {
            from {
                stroke-dashoffset: 100;
            }
            to {
                stroke-dashoffset: 0;
            }
        }
    </style>
</head>
<body class="flex min-h-screen">

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Sidebar -->
    <aside class="w-20 lg:w-64 bg-gray-900/30 p-4 lg:p-6 flex flex-col items-center lg:items-start shrink-0 border-r border-gray-800">
        <div class="flex items-center gap-2 mb-12">
            <svg class="w-10 h-10 neon-text-primary" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7L12 12L22 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <h1 class="font-orbitron text-2xl font-bold hidden lg:block">OASIS</h1>
        </div>
        <nav class="w-full flex flex-col gap-4">
            <a href="#dashboard" class="sidebar-item active p-3 rounded-lg flex items-center gap-4 text-gray-300 hover:text-white" onclick="switchView('dashboard', this)">
                <svg class="sidebar-icon w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                <span class="hidden lg:inline">仪表盘</span>
            </a>
            <a href="#data-sources" class="sidebar-item p-3 rounded-lg flex items-center gap-4 text-gray-300 hover:text-white" onclick="switchView('data-sources', this)">
                <svg class="sidebar-icon w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                <span class="hidden lg:inline">数据源管理</span>
            </a>
            <a href="#insight-engine" class="sidebar-item p-3 rounded-lg flex items-center gap-4 text-gray-300 hover:text-white" onclick="switchView('insight-engine', this)">
                <svg class="sidebar-icon w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.373 3.373 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                <span class="hidden lg:inline">AI洞察引擎</span>
            </a>
            <a href="#action-center" class="sidebar-item p-3 rounded-lg flex items-center gap-4 text-gray-300 hover:text-white" onclick="switchView('action-center', this)">
                <svg class="sidebar-icon w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                <span class="hidden lg:inline">自动化行动中心</span>
            </a>
            <a href="#knowledge-base" class="sidebar-item p-3 rounded-lg flex items-center gap-4 text-gray-300 hover:text-white" onclick="switchView('knowledge-base', this)">
                 <svg class="sidebar-icon w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path><path d="M12 3v18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
                <span class="hidden lg:inline">知识沉淀库</span>
            </a>
        </nav>
        <div class="mt-auto w-full">
            <a href="#settings" class="sidebar-item p-3 rounded-lg flex items-center gap-4 text-gray-300 hover:text-white" onclick="switchView('settings', this)">
                <svg class="sidebar-icon w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                <span class="hidden lg:inline">平台设置</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
        
        <!-- View: Dashboard -->
        <div id="view-dashboard" class="view-content">
            <header class="mb-8">
                <h2 class="text-3xl font-bold font-orbitron">全局态势仪表盘</h2>
                <p class="text-gray-400">实时洞察所有信息源的动态与趋势</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                <!-- Key Metrics -->
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.1s;">
                    <h3 class="text-gray-400 text-lg">新增待办 (ToDo)</h3>
                    <p class="text-4xl font-bold neon-text-primary mt-2">12</p>
                    <p class="text-sm text-green-400 mt-1">+3 since last login</p>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.2s;">
                    <h3 class="text-gray-400 text-lg">关键决策点</h3>
                    <p class="text-4xl font-bold neon-text-primary mt-2">4</p>
                     <p class="text-sm text-gray-400 mt-1">本周已识别</p>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.3s;">
                    <h3 class="text-gray-400 text-lg">高优告警</h3>
                    <p class="text-4xl font-bold neon-text-secondary mt-2">2</p>
                    <p class="text-sm text-red-400 mt-1">用户负面情绪激增</p>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.4s;">
                    <h3 class="text-gray-400 text-lg">知识库新增</h3>
                    <p class="text-4xl font-bold neon-text-primary mt-2">27</p>
                    <p class="text-sm text-gray-400 mt-1">自动归档FAQ和案例</p>
                </div>

                <!-- Main Chart -->
                <div class="md:col-span-2 xl:col-span-2 glassmorphism rounded-xl p-6 flex flex-col fade-in-up" style="animation-delay: 0.5s;">
                    <h3 class="text-xl font-bold mb-4">信息流动 & 情感趋势 (近7天)</h3>
                    <div class="relative h-64">
                        <canvas id="sentimentChart"></canvas>
                    </div>
                </div>

                <!-- Topic Cloud -->
                <div class="md:col-span-2 xl:col-span-2 glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.6s;">
                    <h3 class="text-xl font-bold mb-4">热点主题词云</h3>
                    <div id="wordCloud" class="w-full h-64"></div>
                </div>

                <!-- Recent Summaries -->
                <div class="xl:col-span-4 glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.7s;">
                    <h3 class="text-xl font-bold mb-4">最新AI摘要</h3>
                    <div class="space-y-4 max-h-96 overflow-y-auto pr-2">
                        <div class="p-4 bg-gray-900/50 rounded-lg border-l-4 border-cyan-400">
                            <div class="flex justify-between items-center mb-1">
                                <h4 class="font-bold text-cyan-300">【钉钉】F3项目交付冲刺群</h4>
                                <span class="text-xs text-gray-500">5分钟前</span>
                            </div>
                            <p class="text-sm text-gray-300">摘要：会议确定了下周交付的最终checklist，@张伟 负责的渲染引擎优化需在周三前完成。发现一个潜在风险：供应链芯片可能延迟到货。</p>
                            <div class="mt-2 flex gap-2">
                                <span class="text-xs bg-cyan-900 text-cyan-300 px-2 py-1 rounded">决策点</span>
                                <span class="text-xs bg-yellow-900 text-yellow-300 px-2 py-1 rounded">风险预警</span>
                            </div>
                        </div>
                        <div class="p-4 bg-gray-900/50 rounded-lg border-l-4 border-purple-400">
                            <div class="flex justify-between items-center mb-1">
                                <h4 class="font-bold text-purple-300">【汽车之家】NE-900车型论坛</h4>
                                <span class="text-xs text-gray-500">30分钟前</span>
                            </div>
                            <p class="text-sm text-gray-300">摘要：大量用户集中讨论新的OTA升级，普遍反馈续航有提升，但对车机系统卡顿的抱怨增多。KOL“车长老”发布了详细评测，指出智能驾驶辅助在雨天表现不佳。</p>
                             <div class="mt-2 flex gap-2">
                                <span class="text-xs bg-green-900 text-green-300 px-2 py-1 rounded">正面反馈</span>
                                <span class="text-xs bg-red-900 text-red-300 px-2 py-1 rounded">产品槽点</span>
                            </div>
                        </div>
                         <div class="p-4 bg-gray-900/50 rounded-lg border-l-4 border-green-400">
                            <div class="flex justify-between items-center mb-1">
                                <h4 class="font-bold text-green-300">【知乎】关于新能源汽车电池技术讨论</h4>
                                <span class="text-xs text-gray-500">1小时前</span>
                            </div>
                            <p class="text-sm text-gray-300">摘要：关于固态电池的讨论成为热点，多数观点认为5年内难以商业化。有用户建议公司可以开放电池健康度检测的更多数据给车主。</p>
                             <div class="mt-2 flex gap-2">
                                <span class="text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded">技术趋势</span>
                                <span class="text-xs bg-purple-900 text-purple-300 px-2 py-1 rounded">功能建议</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- View: Data Sources -->
        <div id="view-data-sources" class="view-content hidden">
            <header class="mb-8">
                <h2 class="text-3xl font-bold font-orbitron">数据源连接器管理</h2>
                <p class="text-gray-400">可插拔式设计，轻松连接、配置和管理您的信息来源。</p>
            </header>
            <div class="mb-6 text-right">
                <button class="btn-primary py-2 px-5 rounded-lg font-bold" onclick="openModal('addDataSourceModal')">
                    + 添加新的数据源
                </button>
            </div>
            <div id="data-source-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Data Source Cards -->
                <div class="glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up">
                    <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-07-31/badc2b31-e6b5-4026-b117-5597bbd0c20b.jpeg" class="w-16 h-16 mb-4 object-contain" alt="钉钉图标"/>
                    <h3 class="text-xl font-bold">钉钉</h3>
                    <p class="text-sm text-green-400 font-bold my-2">已连接 (5个群聊)</p>
                    <p class="text-xs text-gray-400 flex-grow">实时同步内部项目群、售后支持群的对话。</p>
                    <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('配置成功')">配置</button>
                </div>
                <div class="glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up" style="animation-delay: 0.1s;">
                    <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-07-31/ca51d189-3c4d-44f8-9a34-848f4cd3c54b.jpeg" class="w-16 h-16 mb-4 object-contain" alt="企业微信图标"/>
                    <h3 class="text-xl font-bold">企业微信</h3>
                    <p class="text-sm text-green-400 font-bold my-2">已连接 (2个群聊)</p>
                    <p class="text-xs text-gray-400 flex-grow">同步销服团队与客户的沟通记录。</p>
                    <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('配置成功')">配置</button>
                </div>
                <div class="glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up" style="animation-delay: 0.2s;">
                    <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-07-31/e1586104-dc89-4b4d-bfd0-7d1dd583e7ba.png" class="w-16 h-16 mb-4 object-contain" alt="知乎图标"/>
                    <h3 class="text-xl font-bold">知乎</h3>
                    <p class="text-sm text-green-400 font-bold my-2">已连接</p>
                    <p class="text-xs text-gray-400 flex-grow">监控与品牌、技术相关的热门问题和回答。</p>
                    <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('配置成功')">配置</button>
                </div>
                <div class="glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up" style="animation-delay: 0.3s;">
                    <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-07-31/7fcc3f94-79df-4d18-be62-03af48451022.png" class="w-16 h-16 mb-4 object-contain" alt="汽车之家图标"/>
                    <h3 class="text-xl font-bold">汽车之家</h3>
                    <p class="text-sm text-yellow-400 font-bold my-2">连接中...</p>
                    <p class="text-xs text-gray-400 flex-grow">实时追踪核心车型论坛的长帖和用户反馈。</p>
                    <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('配置成功')">配置</button>
                </div>
                <div class="glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up opacity-60" style="animation-delay: 0.4s;">
                     <img src="https://img.icons8.com/color/96/weibo.png" class="w-16 h-16 mb-4" alt="微博图标"/>
                    <h3 class="text-xl font-bold">微博</h3>
                    <p class="text-sm text-gray-500 font-bold my-2">未连接</p>
                    <p class="text-xs text-gray-400 flex-grow">连接后可监控品牌相关的公开微博和评论区。</p>
                    <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('连接成功')">连接</button>
                </div>
                 <div class="glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up opacity-60" style="animation-delay: 0.5s;">
                    <img src="https://img.icons8.com/color/96/jira.png" class="w-16 h-16 mb-4" alt="Jira图标"/>
                    <h3 class="text-xl font-bold">Jira</h3>
                    <p class="text-sm text-gray-500 font-bold my-2">未连接</p>
                    <p class="text-xs text-gray-400 flex-grow">连接后可实现对话中的任务与Jira工单联动。</p>
                    <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('连接成功')">连接</button>
                </div>
                 <div class="glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up opacity-60" style="animation-delay: 0.6s;">
                    <svg class="w-16 h-16 mb-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                    <h3 class="text-xl font-bold">开放平台API</h3>
                    <p class="text-sm text-gray-500 font-bold my-2">可用</p>
                    <p class="text-xs text-gray-400 flex-grow">通过SDK和API接入您自己的任意内部系统。</p>
                    <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('已复制API文档链接')">查看文档</button>
                </div>
            </div>
        </div>

        <!-- View: Insight Engine -->
        <div id="view-insight-engine" class="view-content hidden">
            <header class="mb-8">
                <h2 class="text-3xl font-bold font-orbitron">AI 洞察引擎配置</h2>
                <p class="text-gray-400">配置系统的大脑。自定义分析模块，以满足不同业务场景的需求。</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="glassmorphism rounded-xl p-6 fade-in-up">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold neon-text-primary">文本摘要</h3>
                        <label class="switch"><input type="checkbox" checked onclick="showToast('文本摘要已启用')"><span class="slider"></span></label>
                    </div>
                    <p class="text-sm text-gray-400 mt-2 mb-4">从海量文本中提炼核心内容。支持不同角色和粒度的摘要。</p>
                    <div class="space-y-3">
                        <label class="block text-sm font-medium">摘要类型</label>
                        <select class="w-full bg-gray-800 border border-gray-700 rounded-md p-2" onchange="showToast('设置已保存')">
                            <option>通用摘要</option>
                            <option>上下文感知摘要</option>
                            <option>角色化摘要 (面向管理者)</option>
                            <option>角色化摘要 (面向执行者)</option>
                        </select>
                        <label class="block text-sm font-medium">生成频率</label>
                         <select class="w-full bg-gray-800 border border-gray-700 rounded-md p-2" onchange="showToast('设置已保存')">
                            <option>每日日报</option>
                            <option>每周周报</option>
                            <option>实时生成</option>
                        </select>
                    </div>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.1s;">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold neon-text-primary">任务提取 (ToDo)</h3>
                        <label class="switch"><input type="checkbox" checked onclick="showToast('任务提取已启用')"><span class="slider"></span></label>
                    </div>
                    <p class="text-sm text-gray-400 mt-2 mb-4">识别对话中的待办事项，并能分析任务依赖关系。</p>
                    <div class="space-y-3">
                        <label class="block text-sm font-medium">提取模式</label>
                        <select class="w-full bg-gray-800 border border-gray-700 rounded-md p-2" onchange="showToast('设置已保存')">
                            <option>智能提取与推荐负责人</option>
                            <option>仅提取明确指定的任务</option>
                        </select>
                         <label class="block text-sm font-medium">任务链分析</label>
                        <label class="flex items-center gap-2"><input type="checkbox" class="accent-cyan-400" onchange="showToast('设置已保存')"> 自动分析任务依赖</label>
                    </div>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.2s;">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold neon-text-primary">情感与意图分析</h3>
                        <label class="switch"><input type="checkbox" checked onclick="showToast('情感分析已启用')"><span class="slider"></span></label>
                    </div>
                    <p class="text-sm text-gray-400 mt-2 mb-4">分析情绪倾向，并识别投诉、建议、商机等深层意图。</p>
                    <div class="space-y-3">
                        <label class="block text-sm font-medium">分析粒度</label>
                        <select class="w-full bg-gray-800 border border-gray-700 rounded-md p-2" onchange="showToast('设置已保存')">
                            <option>细粒度情感+意图识别</option>
                            <option>通用情感 (积极/中性/消极)</option>
                        </select>
                    </div>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.3s;">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold neon-text-primary">主题建模与演化</h3>
                        <label class="switch"><input type="checkbox" checked onclick="showToast('主题建模已启用')"><span class="slider"></span></label>
                    </div>
                    <p class="text-sm text-gray-400 mt-2 mb-4">发现核心讨论主题，并能跨平台追踪话题演化路径。</p>
                     <div class="space-y-3">
                         <label class="block text-sm font-medium">话题追踪</label>
                        <label class="flex items-center gap-2"><input type="checkbox" class="accent-cyan-400" checked onchange="showToast('设置已保存')"> 开启跨平台话题演化分析</label>
                    </div>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up" style="animation-delay: 0.4s;">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold neon-text-primary">知识图谱构建</h3>
                        <label class="switch"><input type="checkbox" checked onclick="showToast('知识图谱已启用')"><span class="slider"></span></label>
                    </div>
                    <p class="text-sm text-gray-400 mt-2 mb-4">识别自定义实体，构建动态的“人-事-物”关系网络。</p>
                    <div class="space-y-3">
                        <label class="block text-sm font-medium">自定义实体类型</label>
                        <input type="text" value="BUG编号, 项目代号, 竞品车型" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2" onchange="showToast('设置已保存')">
                    </div>
                </div>
            </div>
        </div>

        <!-- View: Action Center -->
        <div id="view-action-center" class="view-content hidden">
            <header class="mb-8">
                <h2 class="text-3xl font-bold font-orbitron">自动化行动中心</h2>
                <p class="text-gray-400">打通“洞察”到“行动”的最后一公里。创建自动化工作流，让洞察自动转化为价值。</p>
            </header>
             <div class="mb-6 text-right">
                <button class="btn-primary py-2 px-5 rounded-lg font-bold" onclick="openModal('workflowEditorModal')">
                    + 创建新的工作流
                </button>
            </div>
            <div id="workflow-list" class="space-y-6">
                <!-- Workflow Rule 1 -->
                <div class="glassmorphism rounded-xl p-6 fade-in-up neon-border">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">舆情告警工作流</h3>
                        <label class="switch"><input type="checkbox" checked onclick="showToast('工作流已激活')"><span class="slider"></span></label>
                    </div>
                    <div class="flex flex-col lg:flex-row items-center gap-4 text-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-400 mb-1">触发器 (TRIGGER)</p>
                            <div class="bg-gray-900 p-3 rounded-lg">
                                <p class="font-mono">当 <span class="text-cyan-400">【汽车之家】</span>出现<span class="text-cyan-400">【“自燃”, “失控”】</span>关键词</p>
                                <p class="font-mono text-lg font-bold text-gray-400">并且</p>
                                <p class="font-mono">情感分析为 <span class="text-red-400">【强烈负面】</span></p>
                            </div>
                        </div>
                        <svg class="w-8 h-8 text-cyan-400 transform lg:rotate-0 rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400 mb-1">动作 (ACTION)</p>
                            <div class="bg-gray-900 p-3 rounded-lg">
                                <p class="font-mono">在 <span class="text-cyan-400">【钉钉】</span>创建 <span class="text-yellow-400">【高优】</span>工单</p>
                                <p class="font-mono text-lg font-bold text-gray-400">并且</p>
                                <p class="font-mono">@ <span class="text-purple-400">【公关部负责人】</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Workflow Rule 2 -->
                <div class="glassmorphism rounded-xl p-6 fade-in-up neon-border-secondary" style="animation-delay: 0.2s;">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">项目进度跟进工作流</h3>
                        <label class="switch"><input type="checkbox" checked onclick="showToast('工作流已激活')"><span class="slider"></span></label>
                    </div>
                    <div class="flex flex-col lg:flex-row items-center gap-4 text-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-400 mb-1">触发器 (TRIGGER)</p>
                            <div class="bg-gray-900 p-3 rounded-lg">
                                <p class="font-mono">当 <span class="text-cyan-400">【钉钉项目群】</span>提取的 <span class="text-cyan-400">【ToDo】</span></p>
                                <p class="font-mono text-lg font-bold text-gray-400">在</p>
                                <p class="font-mono">截止日期前 <span class="text-red-400">【24小时】</span>仍未完成</p>
                            </div>
                        </div>
                        <svg class="w-8 h-8 text-secondary-color transform lg:rotate-0 rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400 mb-1">动作 (ACTION)</p>
                            <div class="bg-gray-900 p-3 rounded-lg">
                                <p class="font-mono">在 <span class="text-cyan-400">【原群聊】</span>中自动发送提醒</p>
                                <p class="font-mono text-lg font-bold text-gray-400">并且</p>
                                <p class="font-mono">@ <span class="text-purple-400">【任务负责人】</span>和<span class="text-purple-400">【项目经理】</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- View: Knowledge Base -->
        <div id="view-knowledge-base" class="view-content hidden">
             <header class="mb-8">
                <h2 class="text-3xl font-bold font-orbitron">动态知识库</h2>
                <p class="text-gray-400">将非结构化的对话数据，转化为结构化、可复用的知识资产。</p>
            </header>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-6">
                    <div class="glassmorphism rounded-xl p-6 fade-in-up">
                        <h3 class="text-xl font-bold mb-4">高频问题 (FAQ) & 解决方案</h3>
                        <div id="faq-list" class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                             <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: NE-900升级后，哨兵模式耗电过快怎么办？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 这是已知问题，临时解决方案是关闭行车记录仪的碰撞检测灵敏度。研发已在排查，预计下个版本修复。 <span class="text-xs text-gray-500">(来源: 售后支持群)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: 如何在车机上安装第三方应用？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 目前系统暂不支持。但有用户在论坛分享了通过开发者模式安装的方法，存在风险，不建议普通用户尝试。 <span class="text-xs text-gray-500">(来源: 汽车之家论坛)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: 预约充电为什么没有在设定时间启动？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 请检查车辆是否在线、地锁是否降下，以及充电枪是否正确连接。部分第三方充电桩可能存在兼容性问题。 <span class="text-xs text-gray-500">(来源: 用户APP反馈)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: 车辆的L2级辅助驾驶在雨雪天气会失效吗？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 在极端天气下，摄像头和雷达等传感器性能会受影响，系统可能会临时禁用或降低功能，这是安全设计。 <span class="text-xs text-gray-500">(来源: 技术支持群)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: 手机蓝牙钥匙感应不灵敏，经常需要掏出手机解锁？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 尝试在手机APP中重新校准蓝牙钥匙，并确保手机的蓝牙和定位服务权限已为应用开启。 <span class="text-xs text-gray-500">(来源: 知乎用户提问)</span></p>
                            </div>
                             <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: 动力电池的质保政策是怎样的？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 我们提供8年或16万公里的三电系统质保，以先到者为准，具体条款请查阅您的购车合同或用户手册。 <span class="text-xs text-gray-500">(来源: 官网政策)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: 如何查看车辆的实时胎压？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 在中控屏的“车辆状态”应用中可以查看四个轮胎的实时压力和温度。当胎压异常时系统会自动告警。 <span class="text-xs text-gray-500">(来源: 产品说明文档)</span></p>
                            </div>
                             <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-cyan-300">Q: OTA升级失败卡在50%怎么办？</p>
                                <p class="text-sm text-gray-300 mt-2">A: 请确保车辆停在网络信号良好的地方（如开阔的地面停车场），并保持电量在40%以上。如果多次尝试失败，请联系400客服或预约到店处理。 <span class="text-xs text-gray-500">(来源: 售后支持群)</span></p>
                            </div>
                        </div>
                    </div>
                     <div class="glassmorphism rounded-xl p-6 fade-in-up">
                        <h3 class="text-xl font-bold mb-4">典型故障案例库</h3>
                         <div id="case-library-list" class="space-y-4 max-h-[300px] overflow-y-auto pr-2">
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-yellow-300">案例#23041: 空调压缩机异响</p>
                                <p class="text-sm text-gray-300 mt-2">现象: 在特定转速下，空调发出规律性高频噪音。诊断: 压缩机某批次支架存在设计缺陷。解决方案: 免费更换改进后的支架。 <span class="text-xs text-gray-500">(来源: 销服群)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-yellow-300">案例#23052: 动力系统故障码 P0A7F (电池模块过热)</p>
                                <p class="text-sm text-gray-300 mt-2">现象: 车辆在高速行驶后仪表盘报动力系统故障，加速受限。诊断: 读取故障码为P0A7F，检查发现3号电池模组温度传感器读数异常。解决方案: 更换3号模组的温度传感器，并对BMS进行软件重校准。 <span class="text-xs text-gray-500">(来源: 维修案例库)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-yellow-300">案例#23061: 充电口盖无法打开</p>
                                <p class="text-sm text-gray-300 mt-2">现象: 按下中控或钥匙上的充电口盖开启键，电机无反应。诊断: 检查发现控制充电口盖的执行器电机保险丝熔断。进一步排查发现电机本身因进水导致短路。解决方案: 更换充电口盖执行器电机总成，并加装新的防水密封圈。 <span class="text-xs text-gray-500">(来源: 售后通报)</span></p>
                            </div>
                            <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-yellow-300">案例#23075: 中控屏频繁黑屏重启</p>
                                <p class="text-sm text-gray-300 mt-2">现象: 行车过程中，中控娱乐屏无故黑屏，数秒后自动重启。诊断: 确认车辆软件为最新版本。检查域控制器日志，发现内存溢出错误。解决方案: 通过OTA推送了针对性的补丁程序，优化了内存管理机制。 <span class="text-xs text-gray-500">(来源: 研发日志)</span></p>
                            </div>
                             <div class="p-4 bg-gray-900/50 rounded-lg">
                                <p class="font-bold text-yellow-300">案例#23088: 车辆休眠后耗电异常</p>
                                <p class="text-sm text-gray-300 mt-2">现象: 车辆锁定并静置一夜后，电量下降超过5%。诊断: 使用专用设备监测车辆休眠电流，发现网关模块（Gateway）未按预期进入深度休眠。解决方案: 重新刷写网关模块固件，解决了其无法进入低功耗模式的问题。 <span class="text-xs text-gray-500">(来源: 维修案例库)</span></p>
                            </div>
                         </div>
                    </div>
                </div>
                <div class="lg:col-span-1 space-y-6">
                    <div class="glassmorphism rounded-xl p-6 fade-in-up">
                        <h3 class="text-xl font-bold mb-4">智能问答 & 专家查找</h3>
                        <input type="text" placeholder="输入您的问题..." class="w-full bg-gray-800 border border-gray-700 rounded-md p-3 mb-4">
                        <button class="btn-primary w-full py-2 rounded-lg" onclick="showToast('正在知识库和专家网络中检索...')">智能检索</button>
                    </div>
                    <div class="glassmorphism rounded-xl p-6 fade-in-up">
                        <h3 class="text-xl font-bold mb-4">专家网络</h3>
                        <p class="text-sm text-gray-400 mb-4">根据历史贡献，系统自动识别出的领域专家。</p>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-08-04/8d9686f5-acc5-40a4-be4c-bab014273761.jpeg" class="w-10 h-10 rounded-full" alt="张伟头像">
                                <div>
                                    <p class="font-bold">张伟</p>
                                    <p class="text-xs text-cyan-400">领域: 渲染引擎, GPU优化</p>
                                </div>
                            </div>
                             <div class="flex items-center gap-3">
                                <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-08-04/ccb10a50-61df-4dcd-9f39-47b62a1c8f8e.jpg" class="w-10 h-10 rounded-full" alt="李静头像">
                                <div>
                                    <p class="font-bold">李静</p>
                                    <p class="text-xs text-cyan-400">领域: 电池BMS, 热管理</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-08-04/03e35c5d-3bbf-4f36-bee9-13d55b9b10b6.jpg" class="w-10 h-10 rounded-full" alt="王超头像">
                                <div>
                                    <p class="font-bold">王超</p>
                                    <p class="text-xs text-cyan-400">领域: 智能座舱, HMI交互</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <img src="https://dingding-erdp.seres.cn/erdp-file/system/prod_env/2025-08-04/937f5bb8-b5fc-42f6-985f-4a3cee95023d.jpeg" class="w-10 h-10 rounded-full" alt="陈悦头像">
                                <div>
                                    <p class="font-bold">陈悦</p>
                                    <p class="text-xs text-cyan-400">领域: 自动驾驶, 传感器融合</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- View: Settings -->
        <div id="view-settings" class="view-content hidden">
            <header class="mb-8">
                <h2 class="text-3xl font-bold font-orbitron">平台设置</h2>
                <p class="text-gray-400">管理用户、角色、权限以及系统全局配置。</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glassmorphism rounded-xl p-6 fade-in-up">
                    <h3 class="text-xl font-bold mb-4">用户与角色管理</h3>
                    <button class="btn-secondary py-2 px-4 rounded-lg mb-4" onclick="showToast('模拟操作：打开邀请用户界面')">+ 邀请新成员</button>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center bg-gray-900/50 p-3 rounded">
                            <span>admin@yourcompany.com (管理员)</span>
                            <button class="text-xs text-red-400 hover:underline" onclick="showToast('操作成功')">移除</button>
                        </div>
                        <div class="flex justify-between items-center bg-gray-900/50 p-3 rounded">
                            <span>zhang.wei@yourcompany.com (成员)</span>
                            <button class="text-xs text-red-400 hover:underline" onclick="showToast('操作成功')">移除</button>
                        </div>
                    </div>
                </div>
                <div class="glassmorphism rounded-xl p-6 fade-in-up">
                    <h3 class="text-xl font-bold mb-4">多租户体系 (SaaS)</h3>
                    <p class="text-gray-400 mb-4">当前为 <span class="font-bold text-cyan-400">企业内部版</span>。升级到SaaS商业版可开启多租户隔离、计费管理等高级功能。</p>
                    <button class="btn-primary w-full py-2 rounded-lg" onclick="showToast('已联系商务顾问')">了解商业版</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Add Data Source Modal -->
    <div id="addDataSourceModal" class="modal-overlay">
        <div class="modal-content glassmorphism rounded-xl w-full max-w-lg m-4">
            <div class="p-6 border-b border-gray-800 flex justify-between items-center">
                <h3 class="text-2xl font-bold font-orbitron">添加新的数据源</h3>
                <button onclick="closeModal('addDataSourceModal')" class="text-gray-500 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div class="p-6">
                <form id="addDataSourceForm" class="space-y-4">
                    <div>
                        <label for="sourceName" class="block text-sm font-medium text-gray-300 mb-1">数据源名称</label>
                        <input type="text" id="sourceName" name="sourceName" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400" placeholder="例如: 市场部舆情监控" required>
                    </div>
                    <div>
                        <label for="sourceType" class="block text-sm font-medium text-gray-300 mb-1">数据源类型</label>
                        <select id="sourceType" name="sourceType" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400">
                            <option value="Webhook">通用 Webhook</option>
                            <option value="Feishu">飞书</option>
                            <option value="Slack">Slack</option>
                            <option value="Custom API">自定义 API</option>
                        </select>
                    </div>
                    <div>
                        <label for="sourceDesc" class="block text-sm font-medium text-gray-300 mb-1">简要描述</label>
                        <textarea id="sourceDesc" name="sourceDesc" rows="3" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400" placeholder="例如: 用于监控飞书上的客户反馈群"></textarea>
                    </div>
                </form>
            </div>
            <div class="p-6 bg-gray-900/30 rounded-b-xl flex justify-end gap-4">
                <button type="button" class="btn-secondary py-2 px-5 rounded-lg" onclick="closeModal('addDataSourceModal')">取消</button>
                <button type="button" class="btn-primary py-2 px-5 rounded-lg font-bold" onclick="addDataSource()">确认添加</button>
            </div>
        </div>
    </div>

    <!-- Workflow Editor Modal -->
    <div id="workflowEditorModal" class="modal-overlay workflow-editor-modal">
        <div class="modal-content glassmorphism rounded-xl w-full max-w-7xl h-[90vh] m-4 flex flex-col">
            <div class="p-4 border-b border-gray-800 flex justify-between items-center shrink-0">
                <div>
                    <h3 class="text-2xl font-bold font-orbitron">可视化工作流编辑器</h3>
                    <input id="workflowName" type="text" class="bg-transparent text-lg text-gray-300 border-b border-gray-600 focus:border-cyan-400 outline-none" value="新的工作流">
                </div>
                <div class="flex items-center gap-4">
                    <button class="btn-secondary py-2 px-5 rounded-lg" onclick="closeModal('workflowEditorModal')">取消</button>
                    <button class="btn-primary py-2 px-5 rounded-lg font-bold" onclick="saveWorkflow()">保存并激活</button>
                </div>
            </div>
            <div class="flex-grow flex min-h-0">
                <!-- Node Palette -->
                <aside class="w-64 bg-gray-900/50 p-4 shrink-0 overflow-y-auto">
                    <h4 class="font-bold text-lg mb-4 neon-text-primary">节点库</h4>
                    <div class="space-y-4">
                        <div>
                            <h5 class="font-bold text-cyan-300 mb-2">触发器 (Triggers)</h5>
                            <div class="space-y-2">
                                <div class="workflow-node bg-gray-800 p-3 rounded-lg" draggable="true" ondragstart="handleDragStart(event, 'trigger-keyword')">
                                    <p class="font-bold">关键词检测</p>
                                    <p class="text-xs text-gray-400">当消息包含特定词汇时</p>
                                </div>
                                <div class="workflow-node bg-gray-800 p-3 rounded-lg" draggable="true" ondragstart="handleDragStart(event, 'trigger-sentiment')">
                                    <p class="font-bold">情感分析</p>
                                    <p class="text-xs text-gray-400">当消息情感为特定类型时</p>
                                </div>
                                 <div class="workflow-node bg-gray-800 p-3 rounded-lg" draggable="true" ondragstart="handleDragStart(event, 'trigger-schedule')">
                                    <p class="font-bold">定时触发</p>
                                    <p class="text-xs text-gray-400">在指定时间自动运行</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 class="font-bold text-purple-300 mb-2">动作 (Actions)</h5>
                            <div class="space-y-2">
                                <div class="workflow-node bg-gray-800 p-3 rounded-lg" draggable="true" ondragstart="handleDragStart(event, 'action-notify')">
                                    <p class="font-bold">发送钉钉通知</p>
                                    <p class="text-xs text-gray-400">在指定群聊或@某人</p>
                                </div>
                                <div class="workflow-node bg-gray-800 p-3 rounded-lg" draggable="true" ondragstart="handleDragStart(event, 'action-todo')">
                                    <p class="font-bold">创建待办事项</p>
                                    <p class="text-xs text-gray-400">在任务中心创建ToDo</p>
                                </div>
                                <div class="workflow-node bg-gray-800 p-3 rounded-lg" draggable="true" ondragstart="handleDragStart(event, 'action-webhook')">
                                    <p class="font-bold">调用 Webhook</p>
                                    <p class="text-xs text-gray-400">向指定URL发送POST请求</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
                <!-- Canvas -->
                <main id="workflow-canvas" class="flex-grow relative" ondragover="handleDragOver(event)" ondrop="handleDrop(event)" onclick="deselectAll(event)">
                    <svg id="workflow-svg-layer"></svg>
                    <!-- Nodes will be added here dynamically -->
                </main>
                <!-- Properties Panel -->
                <aside id="properties-panel" class="w-72 bg-gray-900/50 p-4 shrink-0 overflow-y-auto hidden">
                    <h4 class="font-bold text-lg mb-4 neon-text-secondary">节点配置</h4>
                    <div id="properties-content">
                        <!-- Properties form will be injected here -->
                    </div>
                </aside>
            </div>
        </div>
    </div>


    <script>
        // --- Core UI Logic ---
        // --- Core UI Logic ---
        function switchView(viewId, element) {
            document.querySelectorAll('.view-content').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById('view-' + viewId).classList.remove('hidden');

            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
            
            const viewContent = document.getElementById('view-' + viewId);
            const animatedElements = viewContent.querySelectorAll('.fade-in-up');
            animatedElements.forEach(el => {
                el.style.animation = 'none';
                el.offsetHeight; /* trigger reflow */
                el.style.animation = null; 
            });

            // 修正: 当切换到仪表盘时，调用防抖处理后的函数来重绘词云
            // 这确保了在容器尺寸稳定后再进行渲染
            if (viewId === 'dashboard') {
                debouncedRenderWordCloud();
            }
        }

        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                });
            }, 3000);
        }

        // --- Modal Logic ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if(modal) modal.classList.add('active');
        }
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if(modal) modal.classList.remove('active');
            if(modalId === 'addDataSourceModal') {
                document.getElementById('addDataSourceForm').reset();
            }
        }
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal(modal.id);
                }
            });
        });

        // --- Add Data Source Logic ---
        function addDataSource() {
            const form = document.getElementById('addDataSourceForm');
            const sourceName = form.sourceName.value;
            const sourceType = form.sourceType.value;
            const sourceDesc = form.sourceDesc.value;

            if (!sourceName) {
                showToast('错误：数据源名称不能为空');
                return;
            }

            const grid = document.getElementById('data-source-grid');
            const newCard = document.createElement('div');
            newCard.className = 'glassmorphism rounded-xl p-6 text-center flex flex-col items-center fade-in-up';
            const iconSvg = `<svg class="w-16 h-16 mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>`;

            newCard.innerHTML = `
                ${iconSvg}
                <h3 class="text-xl font-bold">${sourceName}</h3>
                <p class="text-sm text-cyan-400 font-bold my-2">${sourceType}</p>
                <p class="text-xs text-gray-400 flex-grow">${sourceDesc || '暂无描述'}</p>
                <button class="btn-secondary mt-4 w-full py-2 rounded-lg" onclick="showToast('配置成功')">配置</button>
            `;
            
            grid.appendChild(newCard);
            closeModal('addDataSourceModal');
            showToast(`数据源 "${sourceName}" 添加成功！`);
        }

        // --- Workflow Editor Logic ---
        const canvas = document.getElementById('workflow-canvas');
        const svgLayer = document.getElementById('workflow-svg-layer');
        const propertiesPanel = document.getElementById('properties-panel');
        const propertiesContent = document.getElementById('properties-content');

        let nodes = [];
        let connections = [];
        let nodeIdCounter = 0;
        let selectedNode = null;
        let selectedConnection = null;
        let isDraggingNode = false;
        let dragOffsetX, dragOffsetY;
        let tempLine = null;
        let startConnector = null;

        function handleDragStart(event, nodeType) {
            event.dataTransfer.setData('node-type', nodeType);
        }

        function handleDragOver(event) {
            event.preventDefault();
        }

        function handleDrop(event) {
            event.preventDefault();
            const nodeType = event.dataTransfer.getData('node-type');
            if (nodeType) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                createNode(nodeType, x, y);
            }
        }

        function createNode(type, x, y) {
            const nodeId = `node-${nodeIdCounter++}`;
            const nodeData = { id: nodeId, type, x, y, properties: {} };
            
            const nodeElement = document.createElement('div');
            nodeElement.id = nodeId;
            nodeElement.className = 'canvas-node glassmorphism p-3 rounded-lg w-52';
            nodeElement.style.left = `${x}px`;
            nodeElement.style.top = `${y}px`;
            
            let title, description, colorClass;
            if (type.startsWith('trigger')) {
                colorClass = 'border-cyan-400';
                if (type === 'trigger-keyword') { title = '关键词检测'; description = '未配置'; nodeData.properties = { keywords: '' }; }
                if (type === 'trigger-sentiment') { title = '情感分析'; description = '未配置'; nodeData.properties = { sentiment: 'positive' }; }
                if (type === 'trigger-schedule') { title = '定时触发'; description = '未配置'; nodeData.properties = { cron: '0 0 * * *' }; }
            } else {
                colorClass = 'border-purple-400';
                if (type === 'action-notify') { title = '发送钉钉通知'; description = '未配置'; nodeData.properties = { channel: '', message: '' }; }
                if (type === 'action-todo') { title = '创建待办事项'; description = '未配置'; nodeData.properties = { title: '', assignee: '' }; }
                if (type === 'action-webhook') { title = '调用 Webhook'; description = '未配置'; nodeData.properties = { url: '' }; }
            }
            
            nodeElement.innerHTML = `
                <p class="font-bold text-sm ${type.startsWith('trigger') ? 'text-cyan-300' : 'text-purple-300'}">${title}</p>
                <p id="desc-${nodeId}" class="text-xs text-gray-400">${description}</p>
                <div class="node-connector output" data-node-id="${nodeId}" data-connector-type="output"></div>
                <div class="node-connector input" data-node-id="${nodeId}" data-connector-type="input"></div>
            `;
            nodeElement.classList.add(colorClass, 'border-l-4');

            nodeElement.addEventListener('mousedown', startDragNode);
            nodeElement.addEventListener('click', (e) => { e.stopPropagation(); selectNode(nodeData); });
            canvas.appendChild(nodeElement);
            nodes.push(nodeData);
        }

        function selectNode(nodeData) {
            deselectAll(); 
            selectedNode = nodeData;
            document.getElementById(nodeData.id).classList.add('selected');
            propertiesPanel.classList.remove('hidden');
            renderProperties(nodeData);
        }
        
        function deselectAll(event) {
            if (event && event.target !== canvas && !event.target.closest('svg')) {
                return;
            }
            
            if (selectedNode) {
                document.getElementById(selectedNode.id)?.classList.remove('selected');
            }
            selectedNode = null;
            propertiesPanel.classList.add('hidden');

            if (selectedConnection) {
                selectedConnection = null;
                updateConnections();
            }
        }

        function startDragNode(e) {
            if (e.target.classList.contains('node-connector')) return;
            e.preventDefault();
            const nodeElement = e.currentTarget;
            
            const nodeData = nodes.find(n => n.id === nodeElement.id);
            if (!nodeData) return;

            selectNode(nodeData); 
            isDraggingNode = true;
            
            dragOffsetX = e.clientX - nodeElement.offsetLeft;
            dragOffsetY = e.clientY - nodeElement.offsetTop;
            
            document.onmousemove = (moveEvent) => {
                if (!isDraggingNode) return;
                
                let x = moveEvent.clientX - dragOffsetX;
                let y = moveEvent.clientY - dragOffsetY;
                
                x = Math.max(0, Math.min(x, canvas.clientWidth - nodeElement.offsetWidth));
                y = Math.max(0, Math.min(y, canvas.clientHeight - nodeElement.offsetHeight));

                nodeElement.style.left = `${x}px`;
                nodeElement.style.top = `${y}px`;
                
                nodeData.x = x;
                nodeData.y = y;
                
                updateConnections();
            };
            
            document.onmouseup = () => {
                isDraggingNode = false;
                document.onmousemove = null;
                document.onmouseup = null;
            };
        }

        function renderProperties(nodeData) {
            let formHtml = `<p class="mb-4 text-sm">正在配置: <span class="font-bold">${nodeData.id}</span></p>`;
            for (const key in nodeData.properties) {
                formHtml += `
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-400 mb-1">${key}</label>
                        <input type="text" data-property="${key}" class="w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-sm" value="${nodeData.properties[key]}">
                    </div>
                `;
            }
            propertiesContent.innerHTML = formHtml;
            propertiesContent.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', (e) => {
                    nodeData.properties[e.target.dataset.property] = e.target.value;
                    updateNodeDescription(nodeData);
                });
            });
        }
        
        function updateNodeDescription(nodeData) {
            const descElement = document.getElementById(`desc-${nodeData.id}`);
            let descText = '已配置';
            if (nodeData.type === 'trigger-keyword') descText = `关键词: ${nodeData.properties.keywords.substring(0,10) || '...'}`;
            if (nodeData.type === 'action-notify') descText = `通知: ${nodeData.properties.channel.substring(0,10) || '...'}`;
            descElement.textContent = descText;
        }

        canvas.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('node-connector')) {
                startConnector = e.target;
                e.stopPropagation();
                
                tempLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                tempLine.setAttribute('stroke-dasharray', '5,5');
                svgLayer.appendChild(tempLine);

                document.addEventListener('mousemove', drawTempLine);
                document.addEventListener('mouseup', endConnection);
            }
        });

        function drawTempLine(e) {
            if (!startConnector) return;
            const startRect = startConnector.getBoundingClientRect();
            const canvasRect = canvas.getBoundingClientRect();
            const startX = startRect.left + startRect.width / 2 - canvasRect.left;
            const startY = startRect.top + startRect.height / 2 - canvasRect.top;
            const endX = e.clientX - canvasRect.left;
            const endY = e.clientY - canvasRect.top;
            const d = `M ${startX} ${startY} C ${startX + 50} ${startY}, ${endX - 50} ${endY}, ${endX} ${endY}`;
            tempLine.setAttribute('d', d);
        }

        function endConnection(e) {
            if (tempLine) {
                tempLine.remove();
                tempLine = null;
            }
            const endConnector = e.target.closest('.node-connector');
            if (endConnector && endConnector !== startConnector) {
                const startNodeId = startConnector.dataset.nodeId;
                const endNodeId = endConnector.dataset.nodeId;
                const startType = startConnector.dataset.connectorType;
                const endType = endConnector.dataset.connectorType;

                if (startNodeId !== endNodeId && startType !== endType) {
                    const fromNodeId = startType === 'output' ? startNodeId : endNodeId;
                    const toNodeId = startType === 'output' ? endNodeId : startNodeId;

                    const connectionExists = connections.some(c => c.from === fromNodeId && c.to === toNodeId);
                    if (!connectionExists) {
                        const newConnection = { from: fromNodeId, to: toNodeId };
                        connections.push(newConnection);
                        selectConnection(newConnection);
                    } else {
                        showToast('连接已存在');
                    }
                }
            }
            startConnector = null;
            document.removeEventListener('mousemove', drawTempLine);
            document.removeEventListener('mouseup', endConnection);
            updateConnections();
        }

        function updateConnections() {
            svgLayer.innerHTML = '';
            connections.forEach(conn => {
                const fromNodeEl = document.getElementById(conn.from);
                const toNodeEl = document.getElementById(conn.to);
                if (!fromNodeEl || !toNodeEl) return;

                const startX = fromNodeEl.offsetLeft + fromNodeEl.offsetWidth;
                const startY = fromNodeEl.offsetTop + fromNodeEl.offsetHeight / 2;
                const endX = toNodeEl.offsetLeft;
                const endY = toNodeEl.offsetTop + toNodeEl.offsetHeight / 2;
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const d = `M ${startX} ${startY} C ${startX + 70} ${startY}, ${endX - 70} ${endY}, ${endX} ${endY}`;
                path.setAttribute('d', d);
                path.setAttribute('stroke-dasharray', '1000');

                if (selectedConnection && selectedConnection.from === conn.from && selectedConnection.to === conn.to) {
                    path.classList.add('selected');
                }

                path.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectConnection(conn);
                });

                svgLayer.appendChild(path);
            });
        }

        function selectConnection(conn) {
            deselectAll();
            selectedConnection = conn;
            updateConnections();
        }
        
        function deleteSelected() {
            let deleted = false;
            if (selectedNode) {
                const nodeId = selectedNode.id;
                document.getElementById(nodeId)?.remove();
                nodes = nodes.filter(n => n.id !== nodeId);
                connections = connections.filter(c => c.from !== nodeId && c.to !== nodeId);
                selectedNode = null;
                propertiesPanel.classList.add('hidden');
                deleted = true;
            } else if (selectedConnection) {
                connections = connections.filter(c => c.from !== selectedConnection.from || c.to !== selectedConnection.to);
                selectedConnection = null;
                deleted = true;
            }
            
            if (deleted) {
                showToast('已删除所选元素');
                updateConnections();
            }
        }

        document.addEventListener('keydown', (e) => {
            if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') {
                return;
            }

            if (e.key === 'Delete' || e.key === 'Backspace') {
                e.preventDefault();
                deleteSelected();
            }
        });

        function saveWorkflow() {
            const workflowName = document.getElementById('workflowName').value || '未命名工作流';
            const triggerNode = nodes.find(n => n.type.startsWith('trigger'));
            const actionNode = nodes.find(n => n.type.startsWith('action'));

            if (!triggerNode || !actionNode || connections.length === 0) {
                showToast('错误: 工作流不完整，请至少连接一个触发器和一个动作');
                return;
            }
            
            const triggerDesc = document.getElementById(`desc-${triggerNode.id}`).textContent;
            const actionDesc = document.getElementById(`desc-${actionNode.id}`).textContent;

            const workflowList = document.getElementById('workflow-list');
            const newWorkflowCard = document.createElement('div');
            newWorkflowCard.className = 'glassmorphism rounded-xl p-6 fade-in-up neon-border';
            newWorkflowCard.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">${workflowName}</h3>
                    <label class="switch"><input type="checkbox" checked onclick="showToast('工作流已激活')"><span class="slider"></span></label>
                </div>
                <div class="flex flex-col lg:flex-row items-center gap-4 text-center">
                    <div class="flex-1">
                        <p class="text-sm text-gray-400 mb-1">触发器 (TRIGGER)</p>
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <p class="font-mono"><span class="text-cyan-400">${triggerDesc}</span></p>
                        </div>
                    </div>
                    <svg class="w-8 h-8 text-cyan-400 transform lg:rotate-0 rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    <div class="flex-1">
                        <p class="text-sm text-gray-400 mb-1">动作 (ACTION)</p>
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <p class="font-mono"><span class="text-purple-400">${actionDesc}</span></p>
                        </div>
                    </div>
                </div>
            `;
            workflowList.appendChild(newWorkflowCard);
            
            canvas.querySelector('#workflow-svg-layer').innerHTML = '';
            canvas.querySelectorAll('.canvas-node').forEach(n => n.remove());
            nodes = [];
            connections = [];
            nodeIdCounter = 0;
            deselectAll();
            
            closeModal('workflowEditorModal');
            showToast(`工作流 "${workflowName}" 已保存!`);
        }

        // --- Dashboard Chart Logic ---
        const ctx = document.getElementById('sentimentChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(0, 242, 255, 0.5)');
        gradient.addColorStop(1, 'rgba(0, 242, 255, 0)');

        const sentimentChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['7天前', '6天前', '5天前', '4天前', '3天前', '昨天', '今天'],
                datasets: [{
                    label: '信息量',
                    data: [120, 190, 150, 250, 220, 300, 280],
                    borderColor: '#00f2ff',
                    backgroundColor: gradient,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#00f2ff',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 7,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#00f2ff'
                }, {
                    label: '负面情绪指数',
                    data: [20, 30, 25, 40, 60, 55, 50],
                    borderColor: '#ff00ff',
                    tension: 0.4,
                    fill: false,
                    pointBackgroundColor: '#ff00ff',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 7,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#ff00ff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#e0e0e0',
                            font: {
                                family: "'Noto Sans SC', sans-serif"
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#e0e0e0'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: '#e0e0e0'
                        }
                    }
                }
            }
        });

        // --- Word Cloud Logic ---
        const words = [
            {text: '电池续航', size: 90}, {text: 'OTA升级', size: 80},
            {text: '智能驾驶', size: 75}, {text: '车机卡顿', size: 70, color: '#ff00ff'},
            {text: '交付', size: 60}, {text: '供应链', size: 55, color: '#ffc107'},
            {text: 'checklist', size: 50}, {text: '渲染引擎', size: 48},
            {text: '固态电池', size: 45}, {text: '用户建议', size: 42},
            {text: 'KOL', size: 40}, {text: '售后', size: 38},
            {text: '价格', size: 35}, {text: '内饰', size: 32},
        ];

        // 新增: 防抖工具函数，用于延迟函数执行，防止在高频触发（如resize）时造成性能问题
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function renderWordCloud() {
            const container = document.getElementById('wordCloud');
            if (!container || container.clientWidth === 0 || container.clientHeight === 0) {
                return;
            }

            function draw(words) {
                const svgContainer = d3.select("#wordCloud");
                svgContainer.selectAll("*").remove(); // 清除旧的SVG，防止重复渲染
                svgContainer.append("svg")
                    .attr("width", layout.size()[0])
                    .attr("height", layout.size()[1])
                    .append("g")
                    .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                    .selectAll("text")
                    .data(words)
                    .enter().append("text")
                    .style("font-size", d => d.size + "px")
                    .style("font-family", "Noto Sans SC")
                    .style("fill", d => d.color || '#00f2ff')
                    .attr("text-anchor", "middle")
                    .attr("transform", d => "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")")
                    .text(d => d.text)
                    .style("opacity", 0)
                    .transition()
                    .duration(1000)
                    .style("opacity", 1);
            }

            const layout = d3.layout.cloud()
                .size([container.clientWidth, container.clientHeight])
                .words(words)
                .padding(5)
                .rotate(() => (~~(Math.random() * 6) - 3) * 15)
                .font('Noto Sans SC')
                // 修正: 确保布局算法使用的字体大小与最终渲染的大小一致
                .fontSize(d => d.size)
                .on("end", draw);

            layout.start();
        }
        
        // 新增: 创建一个经过防抖处理的渲染函数
        const debouncedRenderWordCloud = debounce(renderWordCloud, 100);

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            const initialView = window.location.hash.substring(1) || 'dashboard';
            const initialLink = document.querySelector(`.sidebar-item[href="#${initialView}"]`);
            if(initialLink) {
                switchView(initialView, initialLink);
            }
            // 首次渲染
            renderWordCloud();
            // 修正: 监听容器尺寸变化时，调用防抖处理过的函数，以获得稳定的尺寸
            new ResizeObserver(debouncedRenderWordCloud).observe(document.getElementById('wordCloud'));
        });

    </script>
</body>
</html>
